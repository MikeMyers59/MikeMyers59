function getHeaderItems(){if(void 0!=_spPageContextInfo&&window.location==window.parent.location){if(_spPageContextInfo.webAbsoluteUrl==location.protocol+"//"+location.host){var a=_spPageContextInfo.userId,b=get_formatted_now()+365;document.cookie="home-usernum ="+a+"; expires="+b+";secure; path=/"}a=new SP.ClientContext("/");var d=a.get_web();b=new SP.ClientContext("/dept/hro");var e=b.get_web().get_lists().getByTitle("Job Announcements"),c=new SP.CamlQuery;c.set_viewXml("<query><Query><Where><And><Gt><FieldRef Name='Modified'></FieldRef><Value Type='DateTime' IncludeTimeValue='TRUE'>"+
get_last_read_jobs()+"</Value></Gt><And><Geq><FieldRef Name='DateClosed'></FieldRef><Value Type='DateTime' IncludeTimeValue='FALSE'><Today /></Value></Geq><Leq><FieldRef Name='DateOpen'></FieldRef><Value Type='DateTime' IncludeTimeValue='FALSE'><Today /></Value></Leq></And></And></Where></Query></query><viewFields><ViewFields><FieldRef Name='Modified' /></ViewFields></viewFields>");
this.jobs_collListItem=e.getItems(c);b.load(jobs_collListItem);e=d.get_lists().getByTitle("News You Can Use");c=new SP.CamlQuery;c.set_viewXml("<query><Query><Where><And><And><And><Leq><FieldRef Name='Begins'></FieldRef><Value Type='DateTime' IncludeTimeValue='FALSE'><Today /></Value></Leq><Geq><FieldRef Name='Expires'></FieldRef><Value Type='DateTime' IncludeTimeValue='FALSE'><Today /></Value></Geq></And><Eq><FieldRef Name='_ModerationStatus'></FieldRef><Value Type='ModStat'>Approved</Value></Eq></And><Gt><FieldRef Name='Modified'></FieldRef><Value Type='DateTime' IncludeTimeValue='TRUE'>"+
get_last_read_news()+"</Value></Gt></And></Where><OrderBy><FieldRef Name='Modified' Ascending='FALSE' />                                 </OrderBy></Query></query><viewFields><ViewFields><FieldRef Name='Modified' /></ViewFields></viewFields>");
this.news_collListItem=e.getItems(c);a.load(news_collListItem);e=new SP.ClientContext("/dept/109");c=e.get_web().get_lists().getByTitle("IT Status");var f=new SP.CamlQuery;f.set_viewXml("<query><Query><Where><Or><IsNull><FieldRef Name='Expires' /></IsNull><Gt><FieldRef Name='Expires' /><Value Type='DateTime' IncludeTimeValue='TRUE'>"+
get_formatted_now()+"</Value></Gt></Or></Where><OrderBy><FieldRef Ascending='FALSE' Name='Modified' /></OrderBy></Query></query><viewFields><ViewFields><FieldRef Name='ID' /><FieldRef Name='Severity' /><FieldRef Name='Title' /><FieldRef Name='Network' /></ViewFields></viewFields>");
this.status_collListItem=c.getItems(f);e.load(status_collListItem);c=new SP.ClientContext("/resources");f=c.get_web().get_lists().getByTitle("Employee Resource Links");var g=new SP.CamlQuery;g.set_viewXml("<query><Query><OrderBy><FieldRef Name='LinkType' /><FieldRef Name='URL' /></OrderBy></Query></query><ViewFields><FieldRef Name='LinkType'/><FieldRef Name='URL'/></ViewFields>");
this.resource_collListItem=f.getItems(g);c.load(resource_collListItem);f=homeportnw_utilities.get_cookie("home-usernum")||"";d=d.get_lists().getByTitle("My Links");g=new SP.CamlQuery;g.set_viewXml("<View><Query><Where><Eq><FieldRef Name='IDofUser'/><Value Type='Number'>"+f+"</Value></Eq></Where><RowLimit>30</RowLimit></Query></View>");this.myLinks_collListItem=
d.getItems(g);a.load(myLinks_collListItem);b.executeQueryAsync(Function.createDelegate(this,this.onQuerySucceededJobs),Function.createDelegate(this,this.onQueryFailed));a.executeQueryAsync(Function.createDelegate(this,this.onQuerySucceededBanner),Function.createDelegate(this,this.onQueryFailed));e.executeQueryAsync(Function.createDelegate(this,this.onQuerySucceededIt),Function.createDelegate(this,this.onQueryFailed));c.executeQueryAsync(Function.createDelegate(this,this.onQuerySucceededResources),
Function.createDelegate(this,this.onQueryFailed));return $.when(dfdJobs,dfdStatus,dfdResources,dfdLinks).then(function(b,a,d,f){a='<div id="BlackBanner"><p>IT Status : PSNS</p><div id="psnsStatus">'+a[0]+'</div><p>NMCI</p><div id="nmciStatus">'+a[1]+'</div><p> | </p><a href="/dept/hro/Lists/JobAnnouncements" target="_blank" id="jobsIcon"><img src="/HomePageFiles/USAJOBS.jpg" /></a><a href="/dept/hro/Lists/JobAnnouncements" target="_blank" class="BannerLink">Jobs</a><a href="/dept/hro/Lists/JobAnnouncements" target="_blank" id="JobsCount" class="counter">'+
b+'</a><p> | </p><a href="/Lists/NewsYouCanUse/Active.aspx" target="_blank" id="nycuIcon"><img src="/HomePageFiles/newspaper.gif" /></a> <a href="/Lists/NewsYouCanUse/Active.aspx" target="_blank" class="BannerLink">NYCU</a><a href="/Lists/NewsYouCanUse/Active.aspx" target="_blank" id="AnnCount" class="counter">'+f[0]+'</a><p> | </p><div class="dropDown"><p>IT Help</p><div id="itDropDownContents"> <ul id="ITMenu"><li><div><a href="/dept/109/ITCoordinators/default.aspx">IT Coordinators</a></div></li><li><div><a href="/dept/109/help/Customer%20Knowledgebase/Home.aspx">IT Support Desk</a></div></li><li><div><a href="/dept/109/help/Customer%20Knowledgebase/Support%20Library.aspx">Support Library</a></div></li></ul></div></div><p> | </p><div id="Resources" class="dropDown"><p>Resources</p><div id="ResDropDownContents">'+
d+'</div></div><div class="dropDown"><p> | </p><div id="hostId">'+hostName+'</div></div><div id="MyLinks" class="dropDown"> <p>My Links</p><div id="MyLinksDropDownContents">'+f[1]+'</div></div><div id="breadCrumb"></div></div>';$("body").prepend(a);$("#ResourceMenu").menu();$("#MyLinksMenu").menu();$("#ITMenu").menu();0<f[0]&&$("#AnnCount").css("visibility","visible");0<b&&$("#JobsCount").css("visibility",
"visible");addBreadCrumb()})}}function onQuerySucceededJobs(){for(var a=jobs_collListItem.getEnumerator(),b=0;a.moveNext();)b++;dfdJobs.resolve(b);jobs_ctx=""}
function onQuerySucceededIt(){for(var a=status_collListItem.getEnumerator(),b,d=[],e=[];a.moveNext();){var c=a.get_current();b=c.get_item("Severity").toLowerCase();var f=c.get_item("Title"),g=c.get_item("Network").toLowerCase();c=c.get_item("ID");b={severity:b,title:f,id:c};"psns"==g?d.push(b):e.push(b)}a=getColor(d);g=getColor(e);b="";switch(a){case 0:b='<img src="/HomePageFiles/green-light.png"/>';break;case 1:b='<div class="dropDown"><img src="/HomePageFiles/yellow-light.png "/>'+addStatusLinks(d);
b+="</div>";break;case 2:b='<div class="dropDown"><img src="/HomePageFiles/red-light.png "/>'+addStatusLinks(d),b+="</div>"}psnsStatus=b;b="";switch(g){case 0:b='<img src="/HomePageFiles/green-light.png"/>';break;case 1:b='<div class="dropDown"><img src="/HomePageFiles/yellow-light.png "/>'+addStatusLinks(e);b+="</div>";break;case 2:b='<div class="dropDown"><img src="/HomePageFiles/red-light.png "/>'+addStatusLinks(e),b+="</div>"}nmciStatus=b;returnStatus=[psnsStatus,nmciStatus];dfdStatus.resolve(returnStatus);
ctx_it=""}function getColor(a){for(var b=0,d=0;d<a.length;d++)1>b&&"yellow"==a[d].severity&&(b=1),2>b&&"red"==a[d].severity&&(b=2);return b}function addStatusLinks(a){var b='<div class="statusDropDownContents">';for(var d=0;d<a.length;d++)b+='<a href="/dept/109/Lists/ITStatus/DispForm.aspx?ID='+a[d].id+'"><p class=',b="yellow"==a[d].severity?b+'"yellowStatus"':"red"==a[d].severity?b+'"redStatus"':b+'"greenStatus"',b+=">"+a[d].title+"</p></a>";return b+"</div>"}
function onQuerySucceededResources(){for(var a,b=[],d=resource_collListItem.getEnumerator();d.moveNext();){var e=d.get_current();a=e.get_item("URL");e=e.get_item("LinkType");a={url:a.get_url(),description:a.get_description(),type:e};b.push(a)}hString="";resDropDownContents=hString=buildResources(b);dfdResources.resolve(resDropDownContents);resource_ctx=""}
function onQuerySucceededBanner(){var a=news_collListItem.getEnumerator();for(count=0;a.moveNext();)count++;a=count;e="";for(var b=[],d=[],e='<li><div><a href="/Lists/My%20Links/myLinks.aspx" id="MyLinks" style="font-weight: 900;"><img src="/_layouts/images/Link.GIF" class="imgMyLinks" />Manage My Links</a></div></li>',c=myLinks_collListItem.getEnumerator();c.moveNext();){var f=c.get_current(),g=[];g=f.get_item("URL");f=f.get_item("Sort_x0020_Order");g={Url:g,Sort:f};f?b.push(g):d.push(g)}b=orderedSort(b);
d=alphaSort(d);b.forEach(function(b){e+='<li><div><a href="'+b.Url.get_url()+'">'+b.Url.get_description()+"</a></div></li>"});d.forEach(function(b){e+='<li><div><a href="'+b.Url.get_url()+'">'+b.Url.get_description()+"</a></div></li>"});dfdLinks.resolve([a,'<ul id="MyLinksMenu">'+e+"</ul>"])}function orderedSort(a){a.sort(function(b,a){b=parseInt(b.Sort);a=parseInt(a.Sort);return b>a?1:b<a?-1:0});return a}
function alphaSort(a){a.sort(function(b,a){b=b.Url.get_description().toLowerCase();a=a.Url.get_description().toLowerCase();return b>a?1:b<a?-1:0});return a}
function buildResources(a){hString='<ul id="ResourceMenu">';for(var b=0;b<a.length;b++)0<b&&b<a.length-1?a[b].type!==a[b-1].type&&(hString+="</ul></li><li><div>"+a[b].type+"</div><ul>"):0==b&&(hString+="<li><div>"+a[b].type+"</div><ul>"),hString+='<li><div><a href="'+a[b].url+'">'+a[b].description+"</a></div></li>",b==a.length-1&&(hString+="</ul></li></ul>");return hString}
function get_last_read_jobs(){latest_read_=homeportnw_utilities.get_cookie("jobannc-last-modified");return get_a_date(latest_read_)}function get_last_read_news(){latest_read_=homeportnw_utilities.get_cookie("nycu-last-modified");return get_a_date(latest_read_)}function get_formatted_now(){return(new Date).toISOString()}function get_a_date(a){return null===a?"1979-02-25T00:00:00Z":a}function onQueryFailed(a,b){alert("Request failed. "+b.get_message()+"\n"+b.get_stackTrace())}
function SetSmallHostValue(a){hostName=a}
function addBreadCrumb(){function a(){if(0<$("#DeltaPlaceHolderPageTitleInTitleArea span span").length&&-1!=document.location.href.indexOf("RootFolder=")){var b=_spPageContextInfo.siteServerRelativeUrl;"/"==b&&(b="");var a=unescape(document.location).split("RootFolder=")[1].split("&Folder")[0].replace(b,"").split("/"),d=_spPageContextInfo.serverRequestPath+"?RootFolder="+b;$.each(a,function(b,a){""!=a&&(d=d+"/"+a,$("#breadcrumbSite").append('<li class="ms-Breadcrumb-listItem"><a class="ms-Breadcrumb-itemLink" href="'+d+
'">'+a+'</a><i class="ms-Breadcrumb-chevron ms-Icon ms-Icon--ChevronRight"></i></li>'))})}}function b(a){var f=document.getElementById("breadcrumbSite");a=new SP.ClientContext(a);var e=a.get_site(),c=a.get_web();a.load(c,"ServerRelativeUrl","Title","ParentWeb","Url");a.load(e,"ServerRelativeUrl");a.executeQueryAsync(function(){if(e.get_serverRelativeUrl()!==c.get_serverRelativeUrl()){var a=document.createElement("li");a.className="ms-Breadcrumb-listItem";a.innerHTML='<a class="ms-Breadcrumb-itemLink" href="'+
c.get_url()+'">'+c.get_title()+'</a><i class="ms-Breadcrumb-chevron ms-Icon ms-Icon--ChevronRight"></i>';f.insertBefore(a,f.childNodes[0]);b(c.get_parentWeb().get_serverRelativeUrl())}else{a=document.createElement("li");a.className="ms-Breadcrumb-listItem";a.innerHTML='<a class="ms-Breadcrumb-itemLink" href="'+c.get_url()+'">'+c.get_title()+'</a><i class="ms-Breadcrumb-chevron ms-Icon ms-Icon--ChevronRight"></i>';f.insertBefore(a,f.childNodes[0]);a=c.get_url();var d=location.protocol+"//"+location.host;
a!=d&&b(d)}},d)}function d(){console.log("Unable to load SharePoint BreadCrumb")}for(var e=[""],c=0;c<e.length;c++)if(document.location.href==e[c])return;SP.SOD.executeFunc("SP.js","SP.ClientContext",function(){var c=SP.ClientContext.get_current(),e=c.get_site(),h=c.get_web();c.load(h,"ServerRelativeUrl","Title","ParentWeb","Url");c.load(e,"ServerRelativeUrl");c.executeQueryAsync(function(){var d=document.createElement("div");d.className="ms-Breadcrumb";d.innerHTML='<div class="ms-FocusZone"><ul id="breadcrumbSite" class="ms-Breadcrumb-list"></ul></div>';
$("#breadCrumb").html(d);d=document.getElementById("breadcrumbSite");if(-1!=document.location.pathname.indexOf("Site Pages")||-1!=document.location.pathname.indexOf("Pages")){var c=document.createElement("li");c.className="ms-Breadcrumb-listItem";1<document.title.split("-").length?c.innerHTML='<span class="ms-Breadcrumb-itemLink">'+document.title.split("-")[1].trim()+'</span><i class="ms-Breadcrumb-chevron ms-Icon ms-Icon--ChevronRight"></i>':c.innerHTML='<span class="ms-Breadcrumb-itemLink">'+document.title.trim()+
'</span><i class="ms-Breadcrumb-chevron ms-Icon ms-Icon--ChevronRight"></i>';d.insertBefore(c,d.childNodes[0])}else-1!=document.location.pathname.indexOf("_layouts/15/")&&(c=document.createElement("li"),c.className="ms-Breadcrumb-listItem",c.innerHTML='<span class="ms-Breadcrumb-itemLink">'+document.title+'</span><i class="ms-Breadcrumb-chevron ms-Icon ms-Icon--ChevronRight"></i>',d.insertBefore(c,d.childNodes[0]));c=document.createElement("li");c.className="ms-Breadcrumb-listItem";c.innerHTML='<a class="ms-Breadcrumb-itemLink" href="'+
h.get_url()+'">'+h.get_title()+'</a><i class="ms-Breadcrumb-chevron ms-Icon ms-Icon--ChevronRight"></i>';d.insertBefore(c,d.childNodes[0]);a();e.get_serverRelativeUrl()!==h.get_serverRelativeUrl()?b(h.get_parentWeb().get_serverRelativeUrl()):(d=h.get_url(),c=location.protocol+"//"+location.host,d!=c&&b(c))},d)});(function(){for(var a=Array.prototype.slice.call((document.getElementById("DeltaPlaceHolderMain")||document).getElementsByTagName("img")),b=a.length,c=0;c<b;++c)-1!=a[c].src.indexOf("breadcrumb.png")&&
(a[c].src=pathBreadCrumb+"/images/breadcrumb.png")})()}var hostName="unk",dfdJobs=$.Deferred(),dfdStatus=$.Deferred(),dfdResources=$.Deferred(),dfdLinks=$.Deferred(),latest_read_=null;SP.SOD.executeOrDelayUntilScriptLoaded(getHeaderItems,"SP.js");
