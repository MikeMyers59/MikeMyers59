function loadHomePage(){var e=SP.ClientContext.get_current(),t=e.get_web(),i=t.get_lists().getByTitle("HomePageVariableList"),a=new SP.CamlQuery;this.var_collListItem=i.getItems(a),e.load(var_collListItem),$("#jssor_1").show(),isInitialized=!0,i=t.get_lists().getByTitle("HomePageSlideImages"),(a=new SP.CamlQuery).set_viewXml("<query><Query><OrderBy><FieldRef Name='SortOrder' Ascending='True'/></OrderBy></Query><ViewFields><FieldRef Name='Title' /><FieldRef Name='Link' /><FieldRef Name='EncodedAbsUrl' /><FieldRef Name='Description' /><FieldRef Name='OpenInNewWindow' /></ViewFields></query>"),this.slide_collListItem=i.getItems(a),e.load(slide_collListItem,"Include(EncodedAbsUrl, Link, Description, OpenInNewWindow)"),i=t.get_lists().getByTitle("OtherHomePageLinks"),a=new SP.CamlQuery,this.otherLinks_collListItem=i.getItems(a),e.load(otherLinks_collListItem),i=t.get_lists().getByTitle("CommanderCorner"),(a=new SP.CamlQuery).set_viewXml("<query> <Query> <OrderBy> <FieldRef Name='Created' Ascending='False' /> </OrderBy> </Query> <RowLimit>1</RowLimit></query>"),this.commanderMessage_collListItem=i.getItems(a),e.load(commanderMessage_collListItem),i=t.get_lists().getByTitle("News You Can Use"),(a=new SP.CamlQuery).set_viewXml("<query><Query><Where><And><Geq><FieldRef Name='Expires'></FieldRef> <Value Type='DateTime' IncludeTimeValue='TRUE'><Today/></Value> </Geq> <And> <Eq> <FieldRef Name='_ModerationStatus'></FieldRef> <Value Type='ModStat'>Approved</Value> </Eq><And><Leq><FieldRef Name='Begins'></FieldRef> <Value Type='DateTime' IncludeTimeValue='FALSE'><Today /></Value> </Leq> <Geq> <FieldRef Name='Expires'></FieldRef> <Value Type='DateTime' IncludeTimeValue='FALSE'><Today /></Value></Geq></And></And></And></Where></Query></query><rowLimit>1000</rowLimit>"),this.digest_collListItem=i.getItems(a),e.load(digest_collListItem),a=t.get_lists().getByTitle("MenuLinks"),t=new SP.CamlQuery,this.menu_collListItem=a.getItems(t),e.load(menu_collListItem,"Include(Title,URL,MainMenuItem,SubMenuItem, SortOrder,SubMenuSortOrder,AccessInformation,MenuItem)"),this.currentUser=e.get_web().get_currentUser(),e.load(this.currentUser),this.userGroups=this.currentUser.get_groups(),e.load(this.userGroups),e.executeQueryAsync(Function.createDelegate(this,this.onQuerySucceededHomePage),Function.createDelegate(this,this.onQueryFailed))}

function onQuerySucceededHomePage(){for(var e,t,a,r,n,o,s,l,c,d,u,g,m,h,p,v,f,_={},w=var_collListItem.getEnumerator();w.moveNext();){var y=w.get_current(),C=y.get_item("Title"),y=y.get_item("Value");Object.defineProperty(_,C,{value:y})}if(e="Dev"==_.Environment?"http://sp2016/":"Test"==_.Environment?"https://homeportnwtest.psns.navy.mil/":"https://homeportnw.psns.navy.mil/",document.getElementById("image_container")){for(var I=[],b=[],x=[],S=[],k=slide_collListItem.getEnumerator();k.moveNext();){var L=k.get_current(),T=L.get_item("EncodedAbsUrl"),A="#",E="",F=L.get_item("OpenInNewWindow");null!=L.get_item("Link")&&(A=(A=L.get_item("Link").get_url()).split(",",1)),null!=L.get_item("Description")&&(E=L.get_item("Description")),I.push(T),b.push(A),x.push(E),S.push(F)}var N="",D='<div id="pause"><img src="'+(1==pause?e+"HomePageFiles/pause.png":e+"HomePageFiles/play.png")+'" onclick="changeAutoPlay()"></div>';for(i=0;i<I.length;i++)"#"===b[i]?N+='<div onClick="AddClick('+I[i]+'\')"><img data-u="image" src="'+I[i]+'" style="height:330px !Important; width:570px !Important" /><div class="slider_image_text" style="top: 0px; left: 570px; width:200px; height:330px" >'+x[i]+'</div><img data-u="thumb" src="'+I[i]+'" /></div>':0==S[i]?N+="<div onClick=\"openDialog('"+b[i]+"','"+I[i]+'\')"><a data-u="image" href="#"><img src="'+I[i]+'"style="height:330px; width:570px" /></a><div class="slider_image_text" style="top: 0px; left: 570px; width:200px; height:330px" >'+x[i]+'</div><img data-u="thumb" src="'+I[i]+'" /></div>':(String.format('<div onClick="window.open(\'{0}\',\'{1}\');AddClick(\'{1}\')"><a data-u="image" href="#"><img src="{1}" style="height:330px; width:570px" />',b[i],I[i]),N+=String.format('<div onClick="window.open(\'{0}\',\'{1}\');AddClick(\'{1}\')"><a data-u="image" href="#"><img src="{1}" style="height:330px; width:570px" />',b[i],I[i]),String.format('</a><div class="slider_image_text" style="top: 0px; left: 570px; width:200px; height:330px" >{0}</div><img data-u="thumb" src="{1}" /></div>',x[i],I[i]),N+=String.format('</a><div class="slider_image_text" style="top: 0px; left: 570px; width:200px; height:330px" >{0}</div><img data-u="thumb" src="{1}" /></div>',x[i],I[i]));$("#image_container").html(N),_initializeRotatingBanner_("jssor_1"),$("#pause").html(D)}for(t=otherLinks_collListItem.getEnumerator(),a=[];t.moveNext();){var M=t.get_current(),P=[j=M.get_item("Title"),he=M.get_item("LinkUrl").get_url(),E=M.get_item("LinkUrl").get_description(),M.get_item("Category"),M.get_item("SortOrder"),M.get_item("New")||!1];a.push(P)}var R='<div class="row"><div class="col" >',U='<div class="row"><div class="col" style="margin-top:10px">',O='<div class="col-4">',Q='<div class="row">',q='<div class="col-2">',B='<span class="newItem"> *New*</span>',V=[],H=0,z=0,W=0,Y=0;for(a.forEach(function(e){V.push(e[3])}),V=sortCategories(V=V.filter(onlyUnique)),i=0;i<V.length;i++)switch(r=[],a.forEach(function(e){V[i]==e[3]&&r.push(e)}),r=sortLink(r),V[i]){case"Hotlines":O+="<h5>"+V[i]+"</h5>",r.forEach(function(e){_.maxMiscCount<=Y&&(O+='</div><div class="col-4">',Y=0),O+=e[5]?'<div><a href="'+e[1]+'" style="color:black; font-weight: bold">'+e[2]+"</a>"+B+"</div>":'<div><a href="'+e[1]+'">'+e[2]+"</a></div>",Y++}),O+="</div>";break;case"Emergency":r.forEach(function(e){_.maxEmergencyCount<=z&&(R+='</div><div class="col offset-1">',z=0),R+=e[5]?'<div><a href="'+e[1]+'" style="color:black; font-weight: bold">'+e[2]+"</a>"+B+"</div>":'<div><a href="'+e[1]+'">'+e[2]+"</a></div>",z++}),R+="</div></div>";break;case"Commander Focus":r.forEach(function(e){_.maxFocusCount<=H&&(U+='</div><div class="col" style="margin-top:10px">',H=0),U+=e[5]?'<div><a href="'+e[1]+'" style="color:black; font-weight: bold">'+e[2]+"</a>"+B+"</div>":'<div><a href="'+e[1]+'">'+e[2]+"</a></div>",H++});break;default:q+="<h5>"+V[i]+"</h5>",r.forEach(function(e){_.maxMiscCount<=W&&(q+='</div><div class="col-2">',W=0),q+=e[5]?'<div><a href="'+e[1]+'" style="color:black; font-weight: bold">'+e[2]+"</a>"+B+"</div>":'<div><a href="'+e[1]+'">'+e[2]+"</a></div>",W++})}for(D='<a href="'+e+_.focusImageLink+'"> <img src="'+e+_.focusImageUrl+'" id="focusPicture" style="max-height: 150px;" alt="Focus Image" target="_blank"/> </a>',Q+=O+q+"</div></div>",$("#CommanderFocusContent").html(U),$("#EmergencyText").html(R),$("#Misc").html(Q),$("#StrategicFrameworkContent").html(D),n=commanderMessage_collListItem.getEnumerator(),o="";n.moveNext();){var J,G=n.get_current(),j=G.get_item("Title"),X=G.get_item("Message"),K=G.get_item("msgDate"),Z=K.getMonth(),ee=K.getFullYear(),te=K.getDate();switch(Z){case 0:J="Jan.";break;case 1:J="Feb.";break;case 2:J="Mar.";break;case 3:J="Apr.";break;case 4:J="May";break;case 5:J="Jun.";break;case 6:J="Jul.";break;case 7:J="Aug.";break;case 8:J="Sep.";break;case 9:J="Oct.";break;case 10:J="Nov.";break;case 11:J="Dec.";break;default:J="Unk."}K=J+" "+te+", "+ee;var ie=G.get_item("FileDirRef")+"/DispForm.aspx?ID="+G.get_item("ID")+"&Source="+e,G=X.replace(/&#160;/g," ");X.replace(/<[^>]*>/g,"").replace(/&#160;/g," ").length.length>_.CommanderMessageLength&&(G=G.substring(0,_.CommanderMessageLength),G+=" ... ",G+='<a href="'+ie+'"><img id="readmore" src="'+e+'HomePageFiles/readmore.png"></a>'),o='<div class="col-9"><p>'+K+"</p><p>"+G+"</p></div>"}$("#CaptCornerText").replaceWith(o),$("#SYCommanderPic").attr("src",e+_.SYCommanderPic),$("#CaptainCornerIcon").attr("src",e+_.CaptainCornerIcon),$("#NewsYouCanUseIcon").attr("src",e+_.NewsYouCanUseIcon);for(var ae=[],re=[],ne=0,oe=0,se=digest_collListItem.getEnumerator();se.moveNext();){var le=se.get_current(),le={digestTitle:le.get_item("Title"),digestText:le.get_item("Body").replace(/<[^>]*>/g,"").replace(/&#160;/g," ").substring(0,_.digestLengthToReturn)+"...",a:ie=le.get_item("FileDirRef")+"/DispForm.aspx?ID="+le.get_item("ID")+"&Source="+e+"&ContentTypeId="+_.contentTypeNumber,pinnedToTop:le.get_item("PinnedToTop")||!1,emergency:le.get_item("Emergency")||!1,date:le.get_item("Created")};re.push(le)}for(oe=0,re.forEach(function(e){1==e.emergency&&(ae.push(e),ne++,re.splice(oe,1)),oe++}),oe=0,re.forEach(function(e){1==e.pinnedToTop&&ne<=_.maxDigestRecordsToReturn-1&&(ae.push(e),ne++,re.splice(oe,1)),oe++}),re.sort(function(e,t){return(e=e.date.valueOf())<(t=t.date.valueOf())?1:-1}),oe=0;ne<=_.maxDigestRecordsToReturn-1;)ae.push(re[oe]),ne++,oe++;s='<div class="row"><div class="col">',l=0,ae.forEach(function(e){3==l&&(s+='</div><div class="col">'),e&&(s+='<a href="'+e.a+'"><div class="NycuDigestItem',!0===e.emergency&&(s+=" Emergency"),s+='"><p class="digestTitle">'+e.digestTitle+'</p><p class="digestText">'+e.digestText+"</p></div></a>",l++)}),s+="</div></div>",$("#NYCU").html(s),$("#AllNYCULink").attr("href",e+_.AllNewsYouCanUseLink);for(var ce=menu_collListItem.getEnumerator(),de=[],ue=[];ce.moveNext();){var ge=ce.get_current(),me=!1,j=ge.get_item("Title"),he=ge.get_item("URL").get_url(),pe=ge.get_item("MainMenuItem").toLowerCase(),ve=ge.get_item("SubMenuItem"),fe=ge.get_item("SortOrder"),_e=ge.get_item("SubMenuSortOrder"),we=ge.get_item("AccessInformation");null==we?me=!1:(me=!0,we=ge.get_item("AccessInformation").get_url()),P=[j,he,pe,ve,fe,me,ge.get_item("MenuItem"),we,_e],de.push(P),ue.push(pe)}for(c='<nav class="navbar navbar-expand-lg navbar-light"><button class="navbar-toggler" type="button" data-toggle="collapse" data-target = "#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarNav"><ul class="navbar-nav mr-auto">',ue=ue.filter(onlyUnique),u=d=0;u<ue.length;u++){for(c+='<li class="nav-item dropdown"><a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" id="'+ue[u]+'Dropdown">'+toTitleCase(ue[u])+'</a><div class="dropdown-menu" aria-labeledby="'+ue[u]+'Dropdown">',c+='<div class="menuContainer"><div class ="column">',g="","apps"!=ue[u]&&"links"!=ue[u]||(g=' target="_blank"'),m=[],oe=0;oe<de.length;oe++)ue[u]==de[oe][2]&&m.push([de[oe][3],de[oe][8]]);for(m=(m=sortSubMenus(m)).filter(onlyUnique),h=[],p=0;p<m.length;p++){for(h=[],oe=0;oe<de.length;oe++)ue[u]==de[oe][2]&&m[p]==de[oe][3]&&(ItemList=[de[oe][0],de[oe][1],de[oe][4],de[oe][5],de[oe][7]],h.push(ItemList));h=sortSubMenuItems(h),v=e+_.keyImage,d+h.length>_.maxMenuColumnCount&&0<p&&(c+='</div><div class="column">',d=0),null!=m[p]&&(c+='<h3 class="dropdown-header">'+m[p]+'</h3><div class="dropdown-divider"></div>'),h.forEach(function(e){c+='<span><a href="'+e[1]+'" class="dropdown-item"'+g+">"+e[0],1==e[3]&&(c+=' <a href="'+e[4]+'"><img src="'+v+'"/></a>'),c+="</a></span>",d===_.maxMenuColumnCount&&(c+='</div><div class="column">',d=0),d++})}c+="</div></div></div></li>",d=0}for(c+="</ul></div>",c+="</nav>",$("#menu").replaceWith(c),windowResizeCheck(),f=this.userGroups.getEnumerator();f.moveNext();)if("HomePage Admin"==f.get_current().get_title()){$("#centerer button").css("display","block");break}window.addEventListener("resize",function(){windowResizeCheck()})}

function _initializeRotatingBanner_(e){function t(){var e=a.$Elmt.parentNode.clientWidth;e?(e=Math.min(r||e,e),a.$ScaleWidth(e)):window.setTimeout(t,30)}var i={$AutoPlay:pause,$Idle:6e3,$SlideDuration:500,$DragOrientation:3,$UISearchMode:0,$ThumbnailNavigatorOptions:{$Class:$JssorThumbnailNavigator$,$ChanceToShow:2,$Loop:1,$SpacingX:3,$SpacingY:3,$ArrowNavigatorOptions:{$Class:$JssorArrowNavigator$,$ChanceToShow:2,$Steps:6}}},a=new $JssorSlider$(e,i),r=800;t(),$Jssor$.$AddEvent(window,"load",t),$Jssor$.$AddEvent(window,"resize",t),$Jssor$.$AddEvent(window,"orientationchange",t)}

function openDialog(e,t){e={url:e,autoSize:!0,allowMaximize:!1,showClose:!0};SP.UI.ModalDialog.showModalDialog(e),AddClick(t)}

function AddClick(e){var t=SP.ClientContext.get_current(),i=t.get_web().get_lists().getByTitle("HomePageSlideImages"),a=new SP.CamlQuery;this.collListItem=i.getItems(a),this.xImage=e,t.load(collListItem,"Include(EncodedAbsUrl, Clicks)"),t.executeQueryAsync(Function.createDelegate(this,this.onQuerySucceeded2),Function.createDelegate(this,this.onQueryFailed))}

function onQuerySucceeded2(){for(var e=SP.ClientContext.get_current(),t=collListItem.getEnumerator();t.moveNext();){var i=t.get_current(),a=i.get_item("EncodedAbsUrl"),r=i.get_item("Clicks");a==this.xImage&&(r=null==r?1:Math.floor(r)+1,i.set_item("Clicks",r),i.update(),e.load(collListItem,"Include(EncodedAbsUrl, Clicks)"),e.executeQueryAsync(function(){},Function.createDelegate(this,this.onQueryFailed)))}}

function getAutoPlayCookie(){var e=homeportnw_utilities.get_cookie("rotator-setting");return null===e&&(e=1),e}

function changeAutoPlay(){var e=1==pause?"0":"1";homeportnw_utilities.set_cookie("rotator-setting",e,365),location.reload()}

function toTitleCase(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}

function sortSubMenus(e){e.sort(function(e,t){return e=e[1],(t=t[1])<e?1:e<t?-1:0});var t=[];return e.forEach(function(e){t.push(e[0])}),t}

function sortSubMenuItems(e){return 0===e[0][2]?e.sort(function(e,t){return e=String(e[0]).toLowerCase(),(t=String(t[0]).toLowerCase())<e?1:e<t?-1:0}):e.sort(function(e,t){return e=e[2],(t=t[2])<e?1:e<t?-1:0}),e}

function onlyUnique(e,t,i){return i.indexOf(e)===t}

function sortCategories(e){return e.sort(function(e,t){return e=String(e).toLowerCase(),(t=String(t).toLowerCase())<e?1:e<t?-1:0}),e}
function sortLink(e){return null==e[0][4]?e.sort(function(e,t){return e=String(e[2]).toLowerCase(),(t=String(t[2]).toLowerCase())<e?1:e<t?-1:0}):e.sort(function(e,t){return e=e[4],(t=t[4])<e?1:e<t?-1:0}),e}

function windowResizeCheck(){1e3<window.innerWidth?$(".navbar").css("height","32px"):$(".navbar").css("height","")}

function onQueryFailed(e,t){alert("Request failed. "+t.get_message()+"\n"+t.get_stackTrace())}

var pause=1, pause=getAutoPlayCookie(), isInitialized=!1;
String.format||(String.format=function(e){var i=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,t){return void 0!==i[t]?i[t]:e})}),SP.SOD.executeOrDelayUntilScriptLoaded(loadHomePage,"SP.js");